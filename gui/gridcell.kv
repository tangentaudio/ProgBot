# GridCell KV Layout
# This file defines the visual layout for GridCell widgets

<GridCell>:
    orientation: 'vertical'
    padding: 5
    spacing: 1
    size_hint: 1, 1
    
    canvas.before:
        Color:
            rgba: root.cell_bg_color[0], root.cell_bg_color[1], root.cell_bg_color[2], root.cell_bg_color[3] * root.pulse_alpha
        Rectangle:
            pos: self.pos
            size: self.size
    
    canvas:
        Color:
            rgba: 0, 0, 0, 0.75
        Rectangle:
            pos: self.x + 4, self.y + 4
            size: self.width - 8, self.height - 8
    
    canvas.after:
        Color:
            rgba: 0, 0, 0, 1
        Line:
            rectangle: (self.x, self.y, self.width, self.height)
            width: 1
    
    # Top row: Board number (left) + result icon (right)
    BoxLayout:
        orientation: 'horizontal'
        size_hint_y: 0.4
        padding: 2, 0
        
        Label:
            text: root.cell_label
            bold: True
            color: root.cell_label_color
            font_size: '22sp'
            size_hint_x: 0.65
            halign: 'left'
            valign: 'top'
            text_size: self.size
            padding: 3, 0
        
        Label:
            text: root.result_icon
            bold: True
            color: root.result_icon_color
            font_size: '26sp'
            font_name: '/usr/share/fonts/truetype/dejavu/DejaVuSans.ttf'
            size_hint_x: 0.35
            halign: 'right'
            valign: 'top'
            text_size: self.size
            padding: 0, 0, 5, 0
            opacity: 1.0 if root.result_icon else 0.0
    
    # Middle row: Serial number (left) + status dots with labels (right)
    BoxLayout:
        orientation: 'horizontal'
        size_hint_y: 0.38
        padding: 2, 0
        opacity: 0.3 if not root.cell_checked else (0.0 if root.failure_reason else 1.0)
        
        Label:
            text: root.serial_number if root.serial_number else ''
            bold: True
            color: [1, 1, 0.7, 1]
            font_size: '11sp'
            size_hint_x: 0.35
            halign: 'left'
            valign: 'middle'
            text_size: self.size
            padding: 3, 0
        
        # Status dots container - right aligned with labels
        BoxLayout:
            orientation: 'horizontal'
            size_hint_x: 0.65
            spacing: 0
            padding: 0, 0, 2, 0
            
            Widget:
                # Spacer to push dots right
                size_hint_x: 0.02
            
            # Vision
            BoxLayout:
                orientation: 'vertical'
                size_hint_x: None
                width: 22
                Label:
                    text: root.vision_dot
                    font_size: '18sp'
                    font_name: '/usr/share/fonts/truetype/dejavu/DejaVuSans.ttf'
                    size_hint_y: 0.65
                    halign: 'center'
                    valign: 'bottom'
                    color: 1, 1, 1, 1 if root.vision_enabled else 0.3
                Label:
                    text: 'V'
                    font_size: '7sp'
                    size_hint_y: 0.35
                    halign: 'center'
                    valign: 'top'
                    color: 0.5, 0.5, 0.5, 1 if root.vision_enabled else 0.2
            
            # Contact (probe)
            BoxLayout:
                orientation: 'vertical'
                size_hint_x: None
                width: 22
                Label:
                    text: root.contact_dot
                    font_size: '18sp'
                    font_name: '/usr/share/fonts/truetype/dejavu/DejaVuSans.ttf'
                    size_hint_y: 0.65
                    halign: 'center'
                    valign: 'bottom'
                    color: 1, 1, 1, 1 if root.contact_enabled else 0.3
                Label:
                    text: 'C'
                    font_size: '7sp'
                    size_hint_y: 0.35
                    halign: 'center'
                    valign: 'top'
                    color: 0.5, 0.5, 0.5, 1 if root.contact_enabled else 0.2
            
            # Program
            BoxLayout:
                orientation: 'vertical'
                size_hint_x: None
                width: 22
                Label:
                    text: root.program_dot
                    font_size: '18sp'
                    font_name: '/usr/share/fonts/truetype/dejavu/DejaVuSans.ttf'
                    size_hint_y: 0.65
                    halign: 'center'
                    valign: 'bottom'
                    color: 1, 1, 1, 1 if root.program_enabled else 0.3
                Label:
                    text: 'P'
                    font_size: '7sp'
                    size_hint_y: 0.35
                    halign: 'center'
                    valign: 'top'
                    color: 0.5, 0.5, 0.5, 1 if root.program_enabled else 0.2
            
            # Provision
            BoxLayout:
                orientation: 'vertical'
                size_hint_x: None
                width: 22
                Label:
                    text: root.provision_dot
                    font_size: '18sp'
                    font_name: '/usr/share/fonts/truetype/dejavu/DejaVuSans.ttf'
                    size_hint_y: 0.65
                    halign: 'center'
                    valign: 'bottom'
                    color: 1, 1, 1, 1 if root.provision_enabled else 0.3
                Label:
                    text: 'S'
                    font_size: '7sp'
                    size_hint_y: 0.35
                    halign: 'center'
                    valign: 'top'
                    color: 0.5, 0.5, 0.5, 1 if root.provision_enabled else 0.2
            
            # Test
            BoxLayout:
                orientation: 'vertical'
                size_hint_x: None
                width: 22
                Label:
                    text: root.test_dot
                    font_size: '18sp'
                    font_name: '/usr/share/fonts/truetype/dejavu/DejaVuSans.ttf'
                    size_hint_y: 0.65
                    halign: 'center'
                    valign: 'bottom'
                    color: 1, 1, 1, 1 if root.test_enabled else 0.3
                Label:
                    text: 'T'
                    font_size: '7sp'
                    size_hint_y: 0.35
                    halign: 'center'
                    valign: 'top'
                    color: 0.5, 0.5, 0.5, 1 if root.test_enabled else 0.2
    
    # Bottom row: Failure reason (only shown when failed)
    Label:
        text: root.failure_reason
        size_hint_y: 0.22
        font_size: '11sp'
        bold: True
        color: [1, 0.7, 0.7, 1]
        halign: 'left'
        valign: 'top'
        text_size: self.width - 6, self.height
        padding: 3, 0
        shorten: True
        shorten_from: 'right'
        opacity: 1.0 if root.failure_reason else 0.0
